# Abstract Factory - Абстрактная фабрика
* Позволяет создавать семейства взаимосвязанных или родственных объектов без указания их конкретных типов.
* Клиент использует абстрактный интерфейс для создания логически связанных продуктов, не зная, какие конкретно продукты будут созданы.
* Абстрактная фабрика представляет собой иерархию создания семейства взаимосвязанных или родственных объектов.

### Аналогия из реального мира
Мебельный магазин производит:
1. Семейство зависимых продуктов: Кресло, Диван, Столик.
2. Вариации этого семейства: Ар-деко, Викторианский, Модерн.

Задачи:
1. Производить продукты так, чтобы они сочетались друг с другом, т.е. были в одном стиле.
2. Быть готовым к тому, что в будущем появятся новые продукты и новые вариации.

### Решаемые проблемы
* Необходимость создавать объекты так, чтобы они сочетались друг с другом.
* При добавлении новых типов и семейств продуктов не должен переписываться или ломаться существующий код (реализация OCP).
* Когда бизнес-логика программы должна работать с разными видами связанных друг с другом продуктов, не завися от конкретных классов продуктов.
  * Абстрактная фабрика скрывает от клиентского кода подробности того, как и какие конкретно объекты будут созданы.
    * Но при этом клиентский код может работать со всеми типами создаваемых продуктов, поскольку их общий интерфейс был заранее определён.
* Когда в программе уже используется [Фабричный метод](../FactoryMethod/FactoryMethod.md), но очередные изменения предполагают введение новых типов продуктов.
  * Каждый класс должен отвечать только за одну вещь (SRP).
  * Если класс имеет слишком много фабричных методов, они способны затуманить его основную функцию.
  * Поэтому имеет смысл вынести всю логику создания продуктов в отдельную иерархию классов, применив абстрактную фабрику.

### Решение
* Выделить общие интерфейсы для отдельных продуктов, составляющих семейства.
* Создать абстрактную фабрику – общий интерфейс для создания всех продуктов семейства.
* Методы абстрактной фабрики возвращают абстрактные типы продуктов, представленные ранее выделенными интерфейсами.
* Для каждой вариации продукта создаётся своя собственная фабрика (реализация интерфейса).
* Клиенты работают с фабриками и продуктами через интерфейс.
* Конкретная фабрика может создаваться при запуске приложения или с помощью паттерна [Одиночка](../Singleton/Singleton.md).

### Диаграмма классов
![Class diagram](AbstractFactory.jpg)
1. `AbstractProduct`. Абстрактные продукты объявляют интерфейсы продуктов, которые связаны друг с другом по смыслу, но выполняют разные функции.
2. `ConcreteProduct`. Конкретные продукты - большой набор классов, которые относятся к различным абстрактным продуктам (кресло/столик), но имеют одни и те же вариации (Викторианский/Модерн).
3. `AbstractFactory`. Абстрактная фабрика объявляет методы создания различных абстрактных продуктов (кресло/столик).
4. `ConcreteFactory`. Конкретные фабрики относятся каждая к своей вариации продуктов (Викторианский/Модерн) и реализуют методы абстрактной фабрики, позволяя создавать все продукты определённой вариации.
5. Несмотря на то, что конкретные фабрики порождают конкретные продукты, сигнатуры их методов должны возвращать соответствующие абстрактные продукты.  
Это позволит клиентскому коду, использующему фабрику, не привязываться к конкретным классам продуктов.  
Клиент сможет работать с любыми вариациями продуктов через абстрактные интерфейсы.

### Недостатки
* Создаётся множество дополнительных классов.
* Требуется наличие всех типов продуктов каждой вариации.
* При появлении нового абстрактного фабричного метода его нужно будет добавить во все реализации фабрик.

### Примеры использования
* Работа с различными типами СУБД.
  * Продукты - различные типы подключений, команд, параметров.
* Работа с различными типами шифрований
  * Продукты - классы, реализующие различные вариации шифрований и дешифрований.
* Работа с различными семействами товаров (н-р, для взрослых и детей).
  * Продукты - одежда, обувь.

### Примеры в .NET
* Класс`DbProviderFactory` из ADO.NET с фабричными методами:
  * `DbConnection CreateConnection()`
  * `DbCommand CreateCommand()`
  * `DbParameter CreateParameter()`.
* Класс `CodeDomProvider` с фабричными методами:
  * `ICodeGenerator CreateGenerator()`.
  * `ICodeCompiler CreateCompiler()`.
  * `ICodeParser CreateParser()`.
* Класс `SymmetricAlgorithm` с фабричными методами:
  * `ICryptoTransform CreateEncryptor()`.
  * `ICryptoTransform CreateDecryptor()`.

### Отношения с другими паттернами
* Абстрактная фабрика может работать совместно с [Мостом](../Bridge/Bridge.md).
   * Это особенно полезно, если есть абстракции, которые могут работать только с некоторыми из реализаций.
      * В этом случае фабрика будет определять типы создаваемых абстракций и реализаций.
* Абстрактная фабрика может быть использована вместо [Фасада](../Facade/Facade.md) для того, чтобы скрыть платформо-зависимые классы.
* Абстрактная фабрика, [Строитель](../Builder/Builder.md) и [Прототип](../Prototype/Prototype.md) могут быть реализованы при помощи [Одиночки](../Singleton/Singleton.md).
* Абстрактная фабрика может хранить набор [прототипов](../Prototype/Prototype.md), которые клонируются и возвращают изготовленные объекты.
* [Строитель](../Builder/Builder.md) концентрируется на построении сложных объектов шаг за шагом, а Абстрактная фабрика специализируется на создании семейств связанных продуктов.
   * Строитель возвращает продукт только после выполнения всех шагов, а Абстрактная фабрика возвращает продукт сразу же.

#### Абстрактная фабрика VS Фабричный метод
Общее: Абстрактная фабрика и [Фабричный метод](../FactoryMethod/FactoryMethod.md) создают объекты различных классов.

| Абстрактная фабрика         | Фабричный метод         |
|-----------------------------|-------------------------|
| Создаёт семейство продуктов | Создаёт один продукт    |
| Использует композицию       | Использует наследование |
